{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}SISALV WEB{% endblock %}</title>

  <link rel="preload" as="style" href="{% static 'sisalv/css/sisalv.css' %}">
  <!--<link rel="stylesheet" href="{% static 'sisalv/css/sisalv.css' %}">-->
  <link rel="stylesheet" href="{% static 'sisalv/css/theme-light.css' %}">
  <link rel="icon" href="{% static 'img/favicon.png' %}">


  {% block extra_css %}{% endblock %}

  <style>
    /* CSS base m√≠nimo (fallback). Seu CSS principal permanece em static/sisalv/css/sisalv.css */
    /* Fundo neutro em degrad√™ de cinza para reduzir fadiga visual */
    :root{--bg:#f3f4f6;--panel:#ffffff;--card:#ffffff;--muted:#64748b;--text:#111827;--primary:#60a5fa;--border:#e5e7eb;--accent:#0ea5e9;}
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial;
      background: linear-gradient(180deg, #f5f6f8, #eef1f5);
      color: var(--text);
    }

    /* Layout privado (logado) */
    .layout{display:grid;grid-template-rows:56px 1fr;grid-template-columns:260px 1fr;grid-template-areas:"topbar topbar" "sidebar content";height:100dvh}
    .topbar{grid-area:topbar;background:rgba(16,24,40,.7);backdrop-filter:saturate(120%) blur(8px);border-bottom:1px solid var(--border)}
    .navbar{display:flex;align-items:center;justify-content:space-between;padding:.5rem 1rem}
    .brand-link{color:var(--text);text-decoration:none;font-weight:700;letter-spacing:.5px}
    .badge{background:var(--primary);color:#fff;padding:.15rem .35rem;border-radius:.35rem;margin-left:.35rem;font-size:.8rem}
    .nav-actions{display:flex;gap:.5rem;align-items:center}
    .btn{border:1px solid var(--border);background:transparent;color:var(--text);padding:.4rem .7rem;border-radius:.5rem;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:.35rem}
    .btn:hover{border-color:var(--accent)} .btn-primary{background:var(--primary);color:#fff;border-color:transparent}
    .btn-primary:hover{filter:brightness(.95)}
    .btn-outline{border-color:var(--accent);color:var(--accent)} .btn-ghost{border-color:transparent}
    .hello{color:var(--muted);margin-right:.25rem}

    .sidebar{grid-area:sidebar;border-right:1px solid var(--border);background:rgba(255,255,255,.8);backdrop-filter:blur(8px);padding:.75rem}
    .menu{display:flex;flex-direction:column;gap:.25rem}
    .menu-section{
      display:flex; align-items:center; gap:.45rem;
      margin:.95rem .25rem .45rem;
      padding:.35rem .6rem;
      font-size:.75rem; font-weight:700; text-transform:uppercase; letter-spacing:.08em;
      color:var(--primary);
      background: rgba(96,165,250,.12);
      border:1px solid rgba(96,165,250,.25);
      border-radius:.5rem;
    }
    .menu-section::before{
      content:"";
      width:8px; height:8px; border-radius:50%;
      background: var(--primary);
      box-shadow: 0 0 0 2px rgba(96,165,250,.18);
    }
    .menu-item{display:block;padding:.55rem .6rem;border-radius:.5rem;color:var(--text);text-decoration:none;border:1px solid transparent;transition:background-color .15s ease, color .15s ease, border-color .15s ease}
    .menu-item:hover{background:var(--primary); color:#fff; border-color:transparent}
    .menu-item.active{background:var(--primary); color:#fff; border-color:transparent}

    .content{grid-area:content;padding:1rem;overflow:auto}
    .card{background:var(--card);border:1px solid var(--border);border-radius:.9rem;padding:1rem;box-shadow:0 10px 24px rgba(0,0,0,.08)}
    .messages{display:flex;flex-direction:column;gap:.5rem;margin-bottom:1rem}
    .alert{position:relative;padding:.7rem .9rem;border-radius:.6rem;border:1px solid var(--border);background:#ffffff}
    .alert-close{position:absolute;right:.5rem;top:.2rem;border:none;background:transparent;color:var(--muted);cursor:pointer}

    @media (max-width:980px){
      .layout{grid-template-columns:0 1fr}
      .sidebar{display:none}
      .sidebar.open{display:block;position:fixed;z-index:30;top:56px;left:0;height:calc(100dvh - 56px);width:230px}
    }
  </style>
</head>

{# body_class permite adicionar classes extras (ex.: "public") a partir do template filho #}
<body class="{% block body_class %}{% endblock %}{% if PUBLIC_LAYOUT %} public{% endif %}">
  {% if not PUBLIC_LAYOUT %}
    {# ====== LAYOUT PRIVADO (logado) ====== #}
    <div class="layout">
      <!-- TOPBAR -->
      <header class="topbar">
        <div class="navbar">
          <div class="brand">
            <a href="/" class="brand-link">SISALV <span class="badge">WEB</span></a>
          </div>
          <div class="nav-actions">
            <button id="sidebarToggle" class="btn btn-ghost" title="Alternar menu">‚ò∞</button>
            <div class="user">
              {% if request.user.is_authenticated %}
                <span class="hello">Ol√°, {{ request.user.first_name|default:request.user.username }}</span>
                <a class="btn btn-primary" href="/admin/">Admin</a>
                <a class="btn btn-outline" href="/logout/">Sair</a>
              {% else %}
                <a class="btn btn-primary" href="/login/">Entrar</a>
              {% endif %}
            </div>
          </div>
        </div>
      </header>

      <!-- SIDEBAR -->
      <aside class="sidebar" id="sidebar">
        <nav class="menu">
          <a href="/" class="menu-item {% block menu_home_active %}{% endblock %}">üè† In√≠cio</a>

          <div class="menu-section">Fiscaliza√ß√£o</div>
          <a href="{% url 'denuncias:listar' %}" class="menu-item {% block menu_denuncias_active %}{% endblock %}">üì£ Den√∫ncias</a>
          <a href="{% url 'notificacoes:listar' %}" class="menu-item {% block menu_notificacoes_active %}{% endblock %}">üìÑ Notifica√ß√µes</a>
          <a href="{% url 'autoinfracao:listar' %}" class="menu-item {% block menu_autoinfracao_active %}{% endblock %}">‚öñÔ∏è Autos de Infra√ß√£o</a>
          <a href="{% url 'autoinfracao:medidas_listar' %}" class="menu-item">‚õî Embargos / Interdi√ß√µes</a>
          <a href="#" class="menu-item">üì¶ Termos de Apreens√£o</a>
          <a href="#" class="menu-item">üìù Vistorias</a>

          <div class="menu-section">Infra√ß√µes</div>
          <a href="{% url 'autoinfracao:enq_listar' %}" class="menu-item">üìú Enquadramentos</a>

          <div class="menu-section">Relat√≥rios</div>
          <a href="#" class="menu-item">üìä Pain√©is e PDFs</a>

          <div class="menu-section">Consultas</div>
          <a href="{% url 'core_mapa' %}" class="menu-item {% block menu_mapa_active %}{% endblock %}">üó∫Ô∏è Consultas Mapa</a>

          <div class="menu-section">Sistema</div>
          <a href="#" class="menu-item">‚öôÔ∏è Configura√ß√µes</a>
        </nav>
      </aside>

      <!-- CONTE√öDO -->
      <main class="content">
        {% if messages %}
          <div class="messages">
            {% for message in messages %}
              <div class="alert {{ message.tags|default:'info' }}">
                {{ message }}
                <button class="alert-close" aria-label="Fechar" onclick="this.parentElement.remove()">√ó</button>
              </div>
            {% endfor %}
          </div>
        {% endif %}

        {% block content %}
        <section class="card">
          <h1>Bem-vindo ao SISALV WEB</h1>
          <p>Use a barra lateral para navegar.</p>
        </section>
        {% endblock %}
      </main>
    </div>
    {% else %}
    {# ====== LAYOUT P√öBLICO (ex.: login) ====== #}
    {# IMPORTANTE: Sem .layout, para o body.public (flex) centralizar corretamente #}
    {% block public_content %}{% endblock %}
  {% endif %}


  {% if not PUBLIC_LAYOUT %}
  <script>
    (function(){
      const toggle = document.getElementById('sidebarToggle');
      const sidebar = document.getElementById('sidebar');
      if(toggle && sidebar){ toggle.addEventListener('click', ()=> sidebar.classList.toggle('open')); }
      setTimeout(()=>{ document.querySelectorAll('.alert').forEach(el=>{ if(!el.classList.contains('sticky')) el.remove(); }); }, 6000);
    })();
  </script>
  {% endif %}

  {% block extra_js %}{% endblock %}
</body>
</html>
