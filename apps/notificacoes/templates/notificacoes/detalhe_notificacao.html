{% extends "core/base.html" %}
{% load static %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'notificacoes/css/notificacoes.css' %}">
{% endblock %}
{% block menu_notificacoes_active %}active{% endblock %}
{% block content %}

<header class="detail-header">
  <div class="left">
    <h1 class="page-title">üîé Detalhe da Notifica√ß√£o</h1>
    <div class="actions">
      <a href="{% url 'notificacoes:listar' %}" class="btn btn-sm btn-secondary">‚Üê Voltar</a>
      <a href="{% url 'notificacoes:editar' obj.pk %}" class="btn btn-sm btn-outline-primary">Editar</a>
      {% if obj.denuncia %}
      <a href="{% url 'denuncias:detalhe' obj.denuncia.pk %}" class="btn btn-sm btn-outline-primary">Ver Den√∫ncia</a>
      {% endif %}
      <a href="{% url 'autoinfracao:from_notificacao' obj.pk %}" class="btn btn-sm btn-primary">Gerar Auto de Infra√ß√£o</a>
    </div>
  </div>
  <div class="right detail-meta">
    <div><strong>Protocolo:</strong> <code class="proto">{{ obj.protocolo }}</code></div>
    <div><strong>Status:</strong> {{ obj.get_status_display }}</div>
    <div><strong>Criada em:</strong> {{ obj.criada_em|date:"d/m/Y H:i" }}</div>
  </div>
</header>

<section class="detail-body">
  <h3>Documentos Relacionados</h3>
  <p>
    <strong>Den√∫ncia:</strong>
    {% if obj.denuncia %}
      <a href="{% url 'denuncias:detalhe' obj.denuncia.pk %}"><code class="proto">{{ obj.denuncia.protocolo }}</code></a>
    {% else %}
      ‚Äî
    {% endif %}
  </p>
  <p>
    <strong>Notifica√ß√£o:</strong>
    <code class="proto">{{ obj.protocolo }}</code>
  </p>
  <p>
    <strong>Auto de Infra√ß√£o:</strong>
    {% if aif %}
      <a href="{% url 'autoinfracao:detalhe' aif.pk %}"><code class="proto">{{ aif.protocolo }}</code></a>
    {% else %}
      ‚Äî
    {% endif %}
  </p>
</section>

<section class="detail-body">
  <h3>Notificado</h3>
  <p><strong>Nome/Raz√£o:</strong> {{ obj.nome_razao }}</p>
  <p><strong>CPF/CNPJ:</strong> {{ obj.cpf_cnpj }}</p>
  <p><strong>Contato:</strong> {{ obj.telefone }} | {{ obj.email }}</p>

  <h3>Endere√ßo</h3>
  <p>
    {{ obj.logradouro }}, {{ obj.numero }} {{ obj.complemento }} ‚Äì {{ obj.bairro }} ‚Äì {{ obj.cidade }}/{{ obj.uf }}<br>
    CEP: {{ obj.cep }}
  </p>

  {% if obj.latitude or obj.longitude %}
  <p><strong>Geo:</strong> {{ obj.latitude }} , {{ obj.longitude }}</p>
  {% endif %}

  <h3>Descri√ß√£o</h3>
  <p style="white-space: pre-line">{{ obj.descricao }}</p>

  {% if obj.prazo_regularizacao %}
    <p><strong>Prazo para Regulariza√ß√£o:</strong> {{ obj.prazo_regularizacao|date:"d/m/Y" }}</p>
  {% endif %}
</section>

<section class="detail-body">
  <h3>üì∑ Fotos e Anexos</h3>
  {% if anexos %}
    <div class="anexos-grid">
      {% for a in anexos %}
        <div class="anexo-item">
          {% if a.tipo == "FOTO" %}
            <a href="{{ a.arquivo.url }}" target="_blank" rel="noopener">
              <img src="{{ a.arquivo.url }}" alt="Foto da notifica√ß√£o" class="thumb" loading="lazy">
            </a>
          {% else %}
            <a href="{{ a.arquivo.url }}" target="_blank" rel="noopener" class="doc-link">
              {{ a.arquivo.name|cut:"notificacoes/anexos/" }}
            </a>
          {% endif %}
          {% if a.observacao %}
            <p class="anexo-legenda">{{ a.observacao }}</p>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p><em>Sem anexos.</em></p>
  {% endif %}
</section>

{% endblock %}
