{% extends "core/base.html" %}
{% block title %}Denúncias — SISALVWEB{% endblock %}

{% block content %}
  <div class="card">
    <h2>Denúncias</h2>

    <form method="get" class="text-center" style="margin-bottom:12px;">
      <input type="text" name="q" value="{{ q }}" placeholder="Buscar por protocolo, nome, endereço">
      <select name="status">
        <option value="">-- status --</option>
        <option value="ABERTA" {% if status_filtro == 'ABERTA' %}selected{% endif %}>Aberta</option>
        <option value="EM_ANALISE" {% if status_filtro == 'EM_ANALISE' %}selected{% endif %}>Em análise</option>
        <option value="ENCAMINHADA_NOTIFICACAO" {% if status_filtro == 'ENCAMINHADA_NOTIFICACAO' %}selected{% endif %}>Encaminhada p/ Notificação</option>
        <option value="ARQUIVADA" {% if status_filtro == 'ARQUIVADA' %}selected{% endif %}>Arquivada</option>
        <option value="CANCELADA" {% if status_filtro == 'CANCELADA' %}selected{% endif %}>Cancelada</option>
      </select>
      <button type="submit">Filtrar</button>
      <a class="link" href="{% url 'denuncias_cadastrar' %}" style="margin-left:8px;">+ Nova denúncia</a>
    </form>

    <table class="table" style="width:100%; border-collapse: collapse;">
      <thead>
        <tr>
          <th style="text-align:left; border-bottom:1px solid #ddd;">Protocolo</th>
          <th style="text-align:left; border-bottom:1px solid #ddd;">Denunciado</th>
          <th style="text-align:left; border-bottom:1px solid #ddd;">Endereço</th>
          <th style="text-align:left; border-bottom:1px solid #ddd;">Status</th>
          <th style="text-align:left; border-bottom:1px solid #ddd;">Criada em</th>
        </tr>
      </thead>
      <tbody>
        {% for d in denuncias %}
        <tr>
          <td><a class="link" href="{% url 'denuncias_detalhe' d.id %}">{{ d.protocolo }}</a></td>
          <td>{{ d.denunciado_nome_razao }}</td>
          <td>{{ d.local_oco_logradouro }} - {{ d.local_oco_bairro }} - {{ d.local_oco_cidade }}/{{ d.local_oco_uf }}</td>
          <td>{{ d.get_status_display }}</td>
          <td>{{ d.criada_em|date:"d/m/Y H:i" }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="5">Nenhuma denúncia encontrada.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
